CMAKE_MINIMUM_REQUIRED(VERSION 2.8.7 FATAL_ERROR)

PROJECT(libporescale)

SET(CMAKE_MODULE_PATH ${CMAKE_HOME_DIRECTORY}/cmake)

### FIND PACKAGES ###
FIND_PACKAGE(OpenMP REQUIRED)

FIND_PACKAGE(MPI REQUIRED)
INCLUDE_DIRECTORIES(${MPI_CXX_INCLUDE_PATH})
SET(PS_LINK_LIBS "${MPI_CXX_LIBRARY}")

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/tpl/metis/include)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/tpl/parmetis/include)
INCLUDE_DIRECTORIES("./include")


### FLAGS AND PS SOURCES SECTION ###
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${MPI_CXX_COMPILE_FLAGS} ${MPI_CXX_LINK_FLAGS} ${OpenMP_CXX_FLAGS} -O2 -std=c++11")

file ( GLOB_RECURSE HEADERS "./include/*" )

file( GLOB_RECURSE SOURCES "./src/*" )

SET(LIBRARY_SRCS ${HEADERS} ${SOURCES})

ADD_LIBRARY(porescale STATIC ${LIBRARY_SRCS})

TARGET_LINK_LIBRARIES(porescale ${PS_LINK_LIBS} ${CMAKE_CURRENT_SOURCE_DIR}/tpl/metis/lib/libmetis.a ${CMAKE_CURRENT_SOURCE_DIR}/tpl/parmetis/lib/libparmetis.a)

INSTALL(TARGETS porescale DESTINATION lib)
INSTALL(FILES ${HEADERS} DESTINATION include)

